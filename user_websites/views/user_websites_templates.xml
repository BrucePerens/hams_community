<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <template id="user_navbar" name="User Websites Navbar">
        <nav t-if="resolved_slug" class="navbar navbar-expand-lg navbar-light bg-light border-bottom user-websites-navbar">
            <div class="container">
                <a class="navbar-brand" t-attf-href="/#{resolved_slug}/home">
                    <t t-if="profile_user">
                        <img t-attf-src="/web/image/res.users/#{profile_user.id}/avatar_128" width="30" height="30" class="d-inline-block align-top rounded-circle me-2" alt=""/>
                        <t t-out="profile_user.name"/>
                    </t>
                    <t t-elif="profile_group">
                        <i class="fa fa-users me-2" aria-hidden="true"/> <t t-out="profile_group.name"/>
                    </t>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#userNavbarNav" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="userNavbarNav">
                    <ul class="navbar-nav me-auto" id="user_navbar_nav_links">
                        <li class="nav-item">
                            <a class="nav-link" t-attf-href="/#{resolved_slug}/home">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" t-attf-href="/#{resolved_slug}/blog">Blog</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </template>

    <template id="layout_inherit_user_navbar" inherit_id="website.layout" name="User Navbar Global">
        <!-- [%ANCHOR: xpath_rendering_navbar] -->
        <!-- Verified by [%ANCHOR: test_xpath_rendering_navbar] -->
        <xpath expr="//head" position="inside"> <!-- audit-ignore-xpath: Tested by [%ANCHOR: test_xpath_rendering_navbar] -->
            <!-- Universal Context Provider for Frontend JS Widgets -->
            <t t-if="resolved_slug">
                <meta name="user_websites_slug" t-att-content="resolved_slug"/>
            </t>
        </xpath>
        <xpath expr="//header" position="after"> <!-- audit-ignore-xpath: Tested by [%ANCHOR: test_xpath_rendering_navbar] -->
            <t t-if="resolved_slug">
                <t t-call="user_websites.user_navbar"/>
            </t>
        </xpath>
    </template>

    <template id="portal_my_home_appeal" inherit_id="portal.portal_my_home" name="Portal My Home Appeal">
        <!-- [%ANCHOR: xpath_rendering_templates] -->
        <!-- Verified by [%ANCHOR: test_xpath_rendering_templates] -->
        <xpath expr="//div[hasclass('o_portal_my_home')]" position="before"> <!-- audit-ignore-xpath: Tested by [%ANCHOR: test_xpath_rendering_templates] -->
            <div class="container mt-4">
                <t t-if="request.env.user.is_suspended_from_websites">
                    <div class="alert alert-danger shadow-sm" role="alert">
                        <h4 class="alert-heading fw-bold"><i class="fa fa-ban me-2"/> Account Suspended</h4>
                        <p>Your user website and blog features have been suspended due to community guideline violations. All your content is currently unpublished.</p>
                        <hr/>
                        
                        <t t-set="existing_appeal" t-value="request.env.user.appeal_ids.filtered(lambda a: a.state == 'new')"/>
                        
                        <t t-if="existing_appeal">
                            <p class="mb-0 text-dark fw-bold"><i class="fa fa-clock-o me-1"/> You have a pending appeal under review by the administrators.</p>
                        </t>
                        <t t-else="">
                            <form action="/website/submit_appeal" method="post">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <div class="mb-3">
                                    <label for="reason" class="form-label fw-bold">Submit an Appeal (One-time only):</label>
                                    <textarea class="form-control" name="reason" id="reason" rows="3" required="required" placeholder="Please explain why your suspension should be lifted..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-danger">Submit Appeal</button>
                            </form>
                        </t>
                    </div>
                </t>
            </div>
        </xpath>
        
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside"> <!-- audit-ignore-xpath: Tested by [%ANCHOR: test_xpath_rendering_templates] -->
            <div class="o_portal_doc_spinner col-12 col-md-6 col-lg-4 mb-4">
                <a href="/my/privacy" class="text-decoration-none d-flex flex-column h-100 p-3 border rounded shadow-sm bg-white">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fa fa-shield fa-2x text-primary me-3"/>
                        <h5 class="mb-0 fw-bold text-dark">Privacy &amp; Data</h5>
                    </div>
                    <div class="text-muted small">Manage your data, export content, and right to erasure.</div>
                </a>
            </div>
        </xpath>
    </template>

    <template id="portal_my_privacy" name="My Privacy &amp; Data">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Privacy &amp; Data</t>
            </t>
            <div class="container mt-4 mb-5">
                <div class="row">
                    <div class="col-12 col-lg-8 mx-auto">
                        <h2 class="fw-bold mb-4">Privacy &amp; Data Management</h2>

                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-body">
                                <h4 class="card-title fw-bold"><i class="fa fa-download text-primary me-2"/> Download My Data</h4>
                                <p class="text-muted">Get a copy of your personal website pages and blog posts in a machine-readable JSON format for data portability purposes.</p>
                                <form action="/my/privacy/export" method="post">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <button type="submit" class="btn btn-outline-primary"><i class="fa fa-download"/> Export Data to JSON</button>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card shadow-sm border-0 border-danger border border-1">
                            <div class="card-body">
                                <h4 class="card-title fw-bold text-danger"><i class="fa fa-trash text-danger me-2"/> Right to Erasure</h4>
                                <p class="text-muted">Permanently delete all of your personal website pages and blog posts. This action also removes you from the public community directory. <strong>This cannot be undone.</strong></p>
                                <form action="/my/privacy/delete_content" method="post" onsubmit="return confirm('Are you absolutely sure you want to permanently delete all your content? This cannot be undone.');">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <button type="submit" class="btn btn-danger"><i class="fa fa-warning"/> Delete All My Content</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="template_default_home" name="User Website Home">
        <t t-call="website.layout">
            <div class="container mt-5">
                <div class="row">
                    <div class="col-12 text-center">
                        <h1 t-if="main_object.name" t-field="main_object.name"/>
                        <h1 t-else="">Welcome</h1>
                        <p class="lead">This is a new user website.</p>
                    </div>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

    <template id="community_directory" name="Community Directory">
        <t t-call="website.layout">
            <div class="container mt-5">
                <div class="row">
                    <div class="col-12">
                        <h1>Community Directory</h1>
                        <p>Explore websites created by our community members.</p>
                    </div>
                </div>
                <div class="row mt-4">
                    <t t-foreach="users" t-as="user">
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 shadow-sm border-0">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        <img t-attf-src="/web/image/res.users/#{user.id}/avatar_128" class="rounded-circle img-thumbnail shadow-sm" style="width: 80px; height: 80px; object-fit: cover;" alt="User Avatar"/>
                                    </div>
                                    <h5 class="card-title fw-bold" t-field="user.name"/>
                                    <a t-attf-href="/{{ user.website_slug }}/home" class="btn btn-outline-primary w-100 mt-2">
                                        Visit Website
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                    <div t-if="not users" class="col-12">
                        <p class="text-muted">No public websites available yet.</p>
                    </div>
                </div>
                <div class="d-flex justify-content-center mt-4 mb-4">
                    <t t-call="website.pager"/>
                </div>
            </div>
        </t>
    </template>

    <template id="report_violation_modal" name="Report Violation Modal">
        <div class="modal fade" id="reportViolationModal" tabindex="-1" role="dialog" aria-labelledby="reportViolationModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form action="/website/report_violation" method="post">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="url" t-att-value="request.httprequest.url"/>
                        
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold" id="reportViolationModalLabel">Report Content Violation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            
                            <div class="mb-3 d-none" aria-hidden="true">
                                <label for="website_honeypot">Leave this field empty if you are human:</label>
                                <input type="text" class="form-control" name="website_honeypot" id="website_honeypot" tabindex="-1" autocomplete="off"/>
                            </div>

                            <t t-if="request.env.user._is_public()">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Your Email Address:</label>
                                    <input type="email" class="form-control" name="email" id="email" required="required" placeholder="name@example.com"/>
                                </div>
                            </t>

                            <div class="mb-3">
                                <label for="description" class="form-label">Reason for reporting:</label>
                                <textarea class="form-control" name="description" id="description" rows="3" required="required"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Submit Report</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </template>

    <template id="report_violation_snippet" name="Report Violation Button">
        <div class="text-center user-websites-report-container d-inline">
            <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#reportViolationModal" t-att-data-url="request.httprequest.url">
                <i class="fa fa-flag"/> Report Violation
            </button>
        </div>
    </template>

    <template id="unsubscribe_success" name="Unsubscription Success">
        <t t-call="website.layout">
            <div class="container mt-5 pt-5 text-center">
                <div class="card shadow-sm border-0 mx-auto" style="max-width: 600px;">
                    <div class="card-body p-5">
                        <i class="fa fa-check-circle text-success" style="font-size: 4rem;"/>
                        <h2 class="mt-4 fw-bold">Unsubscribed Successfully</h2>
                        <p class="lead text-muted mt-3">
                            You have been successfully removed from the mailing list for <strong t-out="record_name"/>. 
                            You will no longer receive weekly digests for this site.
                        </p>
                        <a href="/" class="btn btn-primary mt-4">Return to Homepage</a>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="documentation_page" name="User Websites Documentation">
        <t t-call="website.layout">
            <div class="container mt-5 mb-5 shadow-sm p-5 bg-white rounded">
                <div class="row">
                    <div class="col-12">
                        <h1 class="mb-4 fw-bold">User Websites Module Documentation</h1>
                        <p class="lead text-muted"><strong>Version:</strong> Odoo 19 Community<br/>
                        <strong>Summary:</strong> Enables decentralized, multi-tenant content creation within a single Odoo instance, allowing users to build personal or group-managed websites and blogs.</p>
                        <hr class="mt-4 mb-4"/>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
